@model Benefit.Domain.Models.Order

@{
    ViewBag.Title = "Замовлення №" + Model.OrderNumber;
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}
@section styles
{
    <link href="~/Content/css/order-details.css" rel="stylesheet" />
    <link href="~/Areas/Admin/assets/css/jquery-ui-1.10.3.full.min.css" rel="stylesheet" />
}

@section scripts
    {
    <script src="~/Areas/Admin/assets/js/jquery-ui-1.10.3.full.min.js"></script>
    <script>
        var orderProductFromUrl = '@Url.Action("AddProductForm", new { orderId = Model.Id })';
        var updateOrderStatusUrl = '@Url.Action("UpdateStatus")';
        var updateProductDetailsUrl = '@Url.Action("UpdateOrderProduct")';
        var updateProductOptionDetailsUrl = '@Url.Action("UpdateOrderProductOption")';

        function LoadOrderProductForm() {
            $("#orderProductForm").load(orderProductFromUrl, function (data) {
                $("#dialog").removeClass('hide').dialog({
                    buttons: [
                        {
                            text: "Зберегти",
                            "class": "btn btn-info",
                            click: function () {
                                $("form").submit();
                            }
                        }
                    ]
                });
            });
        };

        $(function() {
            $("#updateStatus").click(function() {
                var status = $("#OrderStatus").val();
                var statusComment = $("#StatusComment").val();
                $.post(updateOrderStatusUrl,
                {
                    orderStatus: status,
                    statusComment: statusComment,
                    orderId: '@Model.Id'
                }, function () {
                    location.reload();
                });
            });

            $(".update-product").click(function() {
                var orderId = '@Model.Id';
                var productId = $(this).attr("data-product-id");
                var tr = $(this).parents("tr");
                var amount = tr.find(".product-amount").val();
                var price = tr.find(".product-price").val();
                $.post(updateProductDetailsUrl, {
                    orderId: orderId,
                    productId: productId,
                    amount: amount,
                    price: price
                }, function(url) {
                    window.location.href = url;
                });
            });

            $(".update-product-option").click(function () {
                var orderId = '@Model.Id';
                var productId = $(this).attr("data-product-id");
                var productOptionId = $(this).attr("data-product-option-id");
                var tr = $(this).parents("tr");
                var amount = tr.find(".product-amount").val();
                var price = tr.find(".product-price").val();
                $.post(updateProductOptionDetailsUrl, {
                    orderId: orderId,
                    productId: productId,
                    productOptionId: productOptionId,
                    amount: amount,
                    price: price
                }, function(url) {
                    window.location.href = url;
                });
            });
        });
    </script>
}
<div id="orderProductForm" class="margin-top-10">
</div>
@Html.Partial("_OrderDetailsPartial", Model)

