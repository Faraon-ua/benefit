@using System.Web.Mvc.Html
@using Benefit.Common.Constants
@using Benefit.DataTransfer.ViewModels
@using Benefit.Domain.Models
@using Benefit.Services.Domain
@model Benefit.Domain.Models.Search.SearchResult

@{
    ViewBag.Title = string.Format("Результати пошуку '{0}'", Model.Term);
}
@section scripts
{
    <script>
        var skip = parseInt('@ListConstants.DefaultTakePerPage');
        var searchProductsUrl = '@Url.Action("GetProducts", "Search")';
        var term = '@Model.Term';

        $(function () {
            $(".ajax_load_btn").click(function (e) {
                e.preventDefault();
                var moreBtn = $(this);
                var currentPage = parseInt(moreBtn.attr("data-page"));
                $(".loader").show();
                $.get(searchProductsUrl + "?term=@Model.Term&sellerId=@Model.SellerId&page=" + (currentPage + 1)//  + "&options=" + options
                ,function (data) {
                    if (data.number <= parseInt('@ListConstants.DefaultTakePerPage')) {
                        moreBtn.hide();
                    }
                    $(".product-item:last").after(data.products);
                    moreBtn.attr("data-page", currentPage + 1);
                    $(".loader").hide();
                });
            });
        });
    </script>
}

<div class="wraps hover_shine" id="content">
    <!--title_content-->
    <div class="top_inner_block_wrapper maxwidth-theme" style="height: 80px;">
        <section class="page-top maxwidth-theme ">
            @Html.Partial("_BreadcrumbsPartial", new BreadCrumbsViewModel()
            {
                Page = new InfoPage()
                {
                    Name = "Пошук"
                }
            })
            <div class="page-top-main">
                Результати пошуку запиту <strong class="bigger-125">"@Model.Term"</strong>
            </div>
        </section>
    </div>

    <div class="wrapper_inner " style=" margin-top: 10px;">
        <div class="right_block  wide_N">
            <div class="middle ">
                <div class="container">
                    <div class="right_block1 clearfix catalog vertical" id="right_block_ajax">

                        <div class="inner_wrapper">
                            <div class="sections_wrapper">
                                <div class="list items">
                                    <div class="row margin0">
                                        @foreach (var product in Model.Products.Take(ListConstants.DefaultTakePerPage))
                                        {
                                            var regionId = RegionService.GetRegionId();
                                            var partialModel = new ProductPartialViewModel { Product = product, CategoryUrl = null, AvailableForPurchase = product.AvailableForPurchase(regionId) };
                                            @Html.Partial("~/Views/Catalog/_ProductPartial.cshtml", partialModel)
                                        }
                                    </div>
                                </div>
                                <div class="bottom_nav margin-top-20">
                                    @if (Model.Products.Count > ListConstants.DefaultTakePerPage)
                                    {
                                        <div class="ajax_load_btn" data-page="0">
                                            <span class="more_text_ajax">Показати ще</span>
                                        </div>
                                    }

                                 
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="left_block">
        </div>
    </div>
</div>